<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LumenAGI v4.2 | Enhanced Observatory</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a2e;
            --bg-elevated: #252542;
            --accent-primary: #ff6b35;
            --accent-secondary: #00ff88;
            --accent-tertiary: #3b82f6;
            --accent-warning: #ffaa00;
            --accent-danger: #ff4444;
            --text-primary: #e0e0e0;
            --text-secondary: #888;
            --border: #2a2a3a;
            --kimi: #3b82f6;
            --qwen: #00ff88;
            --api: #ff6b35;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'SF Pro Display', -apple-system, system-ui, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.5; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; border-bottom: 1px solid var(--border); background: var(--bg-secondary); position: sticky; top: 0; z-index: 100; }
        .logo { display: flex; align-items: center; gap: 1rem; }
        .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .logo-text { font-size: 1.5rem; font-weight: 700; }
        .logo-text span { color: var(--accent-primary); }
        .status-pill { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: rgba(0, 255, 136, 0.1); border: 1px solid var(--accent-secondary); border-radius: 20px; font-size: 0.85rem; }
        .status-pill::before { content: ''; width: 8px; height: 8px; background: var(--accent-secondary); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .connection-status { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-secondary); }
        .connection-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-secondary); transition: all 0.3s; }
        .connection-dot.disconnected { background: var(--accent-danger); animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .main-grid { display: grid; grid-template-columns: 320px 1fr 340px; gap: 1rem; padding: 1rem; max-width: 1920px; margin: 0 auto; }
        .gpu-section, .observatory-section, .stats-section { display: flex; flex-direction: column; gap: 1rem; }
        .card { background: var(--bg-card); border-radius: 12px; padding: 1.25rem; border: 1px solid var(--border); transition: border-color 0.2s; }
        .card:hover { border-color: var(--accent-secondary); }
        .card h2 { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-secondary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .metric { display: flex; justify-content: space-between; align-items: center; padding: 0.6rem 0; border-bottom: 1px solid var(--border); }
        .metric:last-child { border-bottom: none; }
        .metric-label { font-size: 0.8rem; color: var(--text-secondary); }
        .metric-value { font-weight: 600; font-variant-numeric: tabular-nums; font-size: 0.9rem; }
        .metric-value.success { color: var(--accent-secondary); }
        .metric-value.warning { color: var(--accent-warning); }
        .metric-value.danger { color: var(--accent-danger); }
        .chart-container { height: 140px; margin-top: 0.5rem; }
        .swarm-viz { background: var(--bg-card); border-radius: 12px; padding: 1.5rem; border: 1px solid var(--border); }
        .swarm-viz h2 { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--text-secondary); margin-bottom: 1.5rem; }
        .flow-tier { display: flex; justify-content: center; align-items: center; gap: 2rem; margin: 1rem 0; flex-wrap: wrap; }
        .agent-node { display: flex; flex-direction: column; align-items: center; padding: 1rem 1.25rem; background: var(--bg-secondary); border-radius: 12px; border: 2px solid var(--border); min-width: 110px; transition: all 0.3s; position: relative; }
        .agent-node:hover { transform: translateY(-2px); }
        .agent-node.active { border-color: var(--accent-secondary); box-shadow: 0 0 25px rgba(0, 255, 136, 0.3); animation: glow 2s ease-in-out infinite alternate; }
        .agent-node.active::after { content: '‚óè'; position: absolute; top: -8px; right: -8px; width: 16px; height: 16px; background: var(--accent-secondary); border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; color: var(--bg-primary); }
        .agent-node.coordinator { border-color: var(--kimi); }
        .agent-node.worker { border-color: var(--qwen); }
        .agent-avatar { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; margin-bottom: 0.5rem; }
        .agent-avatar.kimi { background: rgba(59, 130, 246, 0.2); }
        .agent-avatar.qwen { background: rgba(0, 255, 136, 0.2); }
        .agent-avatar.api { background: rgba(255, 107, 53, 0.2); }
        .agent-name { font-size: 0.85rem; font-weight: 600; margin-bottom: 0.2rem; }
        .agent-model { font-size: 0.65rem; color: var(--text-secondary); }
        .agent-stats { font-size: 0.6rem; color: var(--accent-secondary); margin-top: 0.3rem; }
        .arrow-down { font-size: 1.25rem; color: var(--text-secondary); opacity: 0.5; }
        .traces-panel { background: var(--bg-card); border-radius: 12px; border: 1px solid var(--border); overflow: hidden; max-height: 400px; display: flex; flex-direction: column; }
        .traces-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.25rem; border-bottom: 1px solid var(--border); background: var(--bg-secondary); }
        .traces-list { overflow-y: auto; flex: 1; padding: 0.5rem; }
        .trace-row { display: grid; grid-template-columns: 2.5rem 1fr auto auto; gap: 0.75rem; align-items: center; padding: 0.5rem; border-bottom: 1px solid var(--border); font-size: 0.8rem; }
        .trace-row:last-child { border-bottom: none; }
        .trace-badge { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
        .trace-badge.running { background: rgba(255, 170, 0, 0.2); animation: pulse 1.5s infinite; }
        .trace-badge.completed { background: rgba(0, 255, 136, 0.2); }
        .trace-badge.error { background: rgba(255, 68, 68, 0.2); }
        .trace-tag { padding: 0.15rem 0.4rem; border-radius: 4px; font-size: 0.6rem; text-transform: uppercase; font-weight: 600; }
        .trace-tag.running { background: rgba(255, 170, 0, 0.15); color: var(--accent-warning); }
        .trace-tag.completed { background: rgba(0, 255, 136, 0.15); color: var(--accent-secondary); }
        .trace-tag.error { background: rgba(255, 68, 68, 0.15); color: var(--accent-danger); }
        .stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; }
        .stat-box { background: var(--bg-card); border-radius: 10px; padding: 1rem; border: 1px solid var(--border); text-align: center; }
        .stat-box h3 { font-size: 0.65rem; text-transform: uppercase; color: var(--text-secondary); margin-bottom: 0.5rem; letter-spacing: 1px; }
        .stat-value { font-size: 1.5rem; font-weight: 700; font-variant-numeric: tabular-nums; }
        .proc-list { display: flex; flex-direction: column; gap: 0.4rem; }
        .proc-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0.6rem; background: var(--bg-secondary); border-radius: 6px; font-size: 0.75rem; }
        .proc-name { display: flex; align-items: center; gap: 0.5rem; }
        .proc-pid { font-family: 'SF Mono', monospace; font-size: 0.6rem; background: var(--bg-card); padding: 0.1rem 0.35rem; border-radius: 3px; color: var(--text-secondary); }
        .memory-container { margin-top: 0.75rem; }
        .memory-header { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-secondary); margin-bottom: 0.4rem; }
        .memory-bar { height: 8px; background: var(--bg-primary); border-radius: 4px; overflow: hidden; }
        .memory-fill { height: 100%; background: linear-gradient(90deg, var(--accent-secondary), #00c853); border-radius: 4px; transition: width 0.3s ease, background 0.3s; }
        .memory-fill.caution { background: linear-gradient(90deg, var(--accent-warning), #ff6d00); }
        .memory-fill.critical { background: linear-gradient(90deg, var(--accent-danger), #cc0000); }
        .badge { display: inline-flex; align-items: center; gap: 0.3rem; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.65rem; font-weight: 600; }
        .badge.green { background: rgba(0, 255, 136, 0.15); color: var(--accent-secondary); }
        .badge.blue { background: rgba(59, 130, 246, 0.15); color: var(--kimi); }
        .badge.orange { background: rgba(255, 107, 53, 0.15); color: var(--accent-primary); }
        .badge.red { background: rgba(255, 68, 68, 0.15); color: var(--accent-danger); }
        .token-tracker { display: flex; flex-direction: column; gap: 0.5rem; }
        .token-row { display: grid; grid-template-columns: 1fr auto auto auto; gap: 0.5rem; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px; font-size: 0.75rem; align-items: center; }
        .token-row.header { background: transparent; font-weight: 600; color: var(--text-secondary); }
        .network-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
        .network-box { background: var(--bg-secondary); border-radius: 8px; padding: 0.75rem; text-align: center; }
        .network-label { font-size: 0.6rem; color: var(--text-secondary); text-transform: uppercase; }
        .network-value { font-size: 1.2rem; font-weight: 700; font-variant-numeric: tabular-nums; }
        @media (max-width: 1400px) { .main-grid { grid-template-columns: 300px 1fr 300px; } }
        @media (max-width: 1200px) { .main-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">üîÆ</div>
            <div class="logo-text">Lumen<span>AGI</span> v4.2</div>
        </div>
        <div class="status-pill">SWARM Active</div>
        <div class="connection-status">
            <div class="connection-dot" id="conn-dot"></div>
            <span id="conn-text">Connecting...</span>
        </div>
    </header>

    <div class="main-grid">
        <!-- Left Panel: GPU & Hardware -->
        <section class="gpu-section">
            <!-- GPU Telemetry -->
            <div class="card">
                <h2>üéÆ GPU Telemetry</h2>
                <div class="metric">
                    <span class="metric-label">Device</span>
                    <span class="metric-value" id="gpu-dev">RTX 3090</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Utilization</span>
                    <span class="metric-value" id="gpu-util">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Temperature</span>
                    <span class="metric-value" id="gpu-temp">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Power</span>
                    <span class="metric-value" id="gpu-power">-</span>
                </div>
                <div class="memory-container">
                    <div class="memory-header">
                        <span>VRAM Usage</span>
                        <span id="vram-label">- / -</span>
                    </div>
                    <div class="memory-bar">
                        <div class="memory-fill" id="vram-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- GPU History -->
            <div class="card">
                <h2>üìà GPU History (60s)</h2>
                <div class="chart-container">
                    <canvas id="gpu-chart"></canvas>
                </div>
            </div>

            <!-- Network Traffic -->
            <div class="card">
                <h2>üåê Network Traffic</h2>
                <div class="network-stats">
                    <div class="network-box">
                        <div class="network-label">‚¨ÜÔ∏è Upload</div>
                        <div class="network-value" id="net-up">0</div>
                        <div style="font-size: 0.6rem; color: var(--text-secondary);">Mbps</div>
                    </div>
                    <div class="network-box">
                        <div class="network-label">‚¨áÔ∏è Download</div>
                        <div class="network-value" id="net-down">0</div>
                        <div style="font-size: 0.6rem; color: var(--text-secondary);">Mbps</div>
                    </div>
                </div>
            </div>

            <!-- Ollama Models -->
            <div class="card">
                <h2>üß† Ollama Models</h2>
                <div id="ollama-list" class="proc-list">
                    <div class="proc-item"><span class="metric-label">No models loaded</span></div>
                </div>
            </div>

            <!-- GPU Processes -->
            <div class="card">
                <h2>üî• GPU Processes</h2>
                <div id="gpu-procs" class="proc-list">
                    <div class="proc-item"><span class="metric-label">No GPU processes</span></div>
                </div>
            </div>
        </section>

        <!-- Center Panel: SWARM & Traces -->
        <section class="observatory-section">
            <!-- SWARM Topology -->
            <div class="swarm-viz">
                <h2>üï∏Ô∏è SWARM Topology</h2>
                <div class="flow-tier">
                    <div class="agent-node coordinator" id="node-main">
                        <div class="agent-avatar kimi">üß†</div>
                        <div class="agent-name">Lumen</div>
                        <div class="agent-model">kimi-2.5</div>
                        <div class="agent-stats" id="main-stats">Idle</div>
                    </div>
                </div>
                <div class="flow-tier">
                    <span class="arrow-down">‚Üì</span>
                </div>
                <div class="flow-tier">
                    <div class="agent-node worker" id="node-research">
                        <div class="agent-avatar api">üîç</div>
                        <div class="agent-name">Research</div>
                        <div class="agent-model">gpt-4o</div>
                        <div class="agent-stats" id="research-stats">Cloud API</div>
                    </div>
                    <div class="agent-node worker" id="node-build">
                        <div class="agent-avatar qwen">üî®</div>
                        <div class="agent-name">Build</div>
                        <div class="agent-model">qwen32</div>
                        <div class="agent-stats" id="build-stats">20GB VRAM</div>
                    </div>
                    <div class="agent-node worker" id="node-create">
                        <div class="agent-avatar qwen">üé®</div>
                        <div class="agent-name">Create</div>
                        <div class="agent-model">qwen32</div>
                        <div class="agent-stats" id="create-stats">20GB VRAM</div>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="stat-grid">
                <div class="stat-box">
                    <h3>Context</h3>
                    <div class="stat-value" style="color: var(--qwen);">128K</div>
                    <div class="badge green">‚úì limit</div>
                </div>
                <div class="stat-box">
                    <h3>Agents</h3>
                    <div class="stat-value" id="agent-count">4</div>
                    <div class="badge blue">SWARM</div>
                </div>
                <div class="stat-box">
                    <h3>Throughput</h3>
                    <div class="stat-value" style="color: var(--accent-secondary);">35</div>
                    <div class="badge green">tok/s</div>
                </div>
                <div class="stat-box">
                    <h3>Session Cost</h3>
                    <div class="stat-value" id="session-cost" style="color: var(--accent-primary);">$0.00</div>
                    <div class="badge orange">accumulating</div>
                </div>
            </div>

            <!-- Real-time Traces -->
            <div class="traces-panel">
                <div class="traces-header">
                    <h2>üìä Real-time Traces</h2>
                    <div class="badge green">LIVE</div>
                </div>
                <div class="traces-list" id="traces-list">
                    <div class="proc-item" style="justify-content: center; color: var(--text-secondary);">
                        <span>Waiting for agent activity...</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Right Panel: Stats & Tracking -->
        <section class="stats-section">
            <!-- Token Tracking -->
            <div class="card">
                <h2>üé´ Token Tracking</h2>
                <div class="token-tracker">
                    <div class="token-row header">
                        <span>Agent</span>
                        <span>In</span>
                        <span>Out</span>
                        <span>Total</span>
                    </div>
                    <div class="token-row">
                        <span><span style="color: var(--kimi);">‚óè</span> Kimi</span>
                        <span id="tokens-kimi-in">0</span>
                        <span id="tokens-kimi-out">0</span>
                        <span id="tokens-kimi-total" style="font-weight: 600;">0</span>
                    </div>
                    <div class="token-row">
                        <span><span style="color: var(--qwen);">‚óè</span> Qwen32</span>
                        <span id="tokens-qwen-in">0</span>
                        <span id="tokens-qwen-out">0</span>
                        <span id="tokens-qwen-total" style="font-weight: 600;">0</span>
                    </div>
                    <div class="token-row">
                        <span><span style="color: var(--api);">‚óè</span> GPT-4o</span>
                        <span id="tokens-gpt4o-in">0</span>
                        <span id="tokens-gpt4o-out">0</span>
                        <span id="tokens-gpt4o-total" style="font-weight: 600;">0</span>
                    </div>
                </div>
            </div>

            <!-- Cost Tracking -->
            <div class="card">
                <h2>üí∞ Cost Tracking</h2>
                <div class="proc-list">
                    <div class="proc-item">
                        <span class="proc-name"><span style="font-size: 1rem;">‚òÅÔ∏è</span> Kimi Cloud</span>
                        <span id="cost-kimi" style="font-family: monospace; font-weight: 600;">$0.0000</span>
                    </div>
                    <div class="proc-item">
                        <span class="proc-name"><span style="font-size: 1rem;">üè†</span> Qwen32 Local</span>
                        <span id="cost-qwen" style="font-family: monospace; font-weight: 600; color: var(--accent-secondary);">$0.00</span>
                    </div>
                    <div class="proc-item">
                        <span class="proc-name"><span style="font-size: 1rem;">üñºÔ∏è</span> GPT-4o API</span>
                        <span id="cost-gpt4o" style="font-family: monospace; font-weight: 600;">$0.0000</span>
                    </div>
                    <div class="proc-item" style="background: rgba(255, 107, 53, 0.1); border: 1px solid var(--accent-primary);">
                        <span class="proc-name"><strong>üíµ TOTAL</strong></span>
                        <span id="cost-total" style="font-family: monospace; font-weight: 700; color: var(--accent-primary);">$0.0000</span>
                    </div>
                </div>
            </div>

            <!-- Agent Activity Chart -->
            <div class="card">
                <h2>üìà Agent Activity</h2>
                <div class="chart-container">
                    <canvas id="agent-chart"></canvas>
                </div>
            </div>

            <!-- Architecture Info -->
            <div class="card">
                <h2>üèóÔ∏è Architecture</h2>
                <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.8rem;">
                    <div class="metric">
                        <span class="metric-label">Cerebro</span>
                        <span style="color: var(--kimi); font-weight: 600;">kimi-2.5</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Workers</span>
                        <span style="color: var(--qwen); font-weight: 600;">qwen32 √ó 3</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">VRAM Total</span>
                        <span class="metric-value">24GB</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Update Rate</span>
                        <span class="metric-value">1s</span>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // SocketIO Connection
        const socket = io('http://127.0.0.1:8766');
        const connDot = document.getElementById('conn-dot');
        const connText = document.getElementById('conn-text');
        
        // Charts
        let gpuChart, agentChart;
        
        // Initialize GPU History Chart
        function initGpuChart() {
            const ctx = document.getElementById('gpu-chart').getContext('2d');
            gpuChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(60).fill(''),
                    datasets: [{
                        label: 'GPU %',
                        data: Array(60).fill(0),
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }, {
                        label: 'VRAM %',
                        data: Array(60).fill(0),
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { 
                            beginAtZero: true, 
                            max: 100,
                            ticks: { color: '#888', font: { size: 9 } },
                            grid: { color: '#2a2a3a' }
                        }
                    },
                    animation: false
                }
            });
        }
        
        // Initialize Agent Activity Chart
        function initAgentChart() {
            const ctx = document.getElementById('agent-chart').getContext('2d');
            agentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array(60).fill(''),
                    datasets: [{
                        label: 'Qwen Local',
                        data: Array(60).fill(0),
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }, {
                        label: 'Kimi Cloud',
                        data: Array(60).fill(0),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true, labels: { color: '#888', font: { size: 9 } } } },
                    scales: {
                        x: { display: false },
                        y: { 
                            beginAtZero: true,
                            ticks: { color: '#888', font: { size: 9 } },
                            grid: { color: '#2a2a3a' }
                        }
                    },
                    animation: false
                }
            });
        }
        
        socket.on('connect', () => {
            console.log('‚úÖ SocketIO Connected');
            connDot.classList.remove('disconnected');
            connDot.style.background = '#00ff88';
            connText.textContent = 'Connected (SocketIO)';
            initGpuChart();
            initAgentChart();
        });
        
        socket.on('metrics', (data) => {
            // GPU Metrics
            if (data.gpu) {
                const g = data.gpu;
                document.getElementById('gpu-dev').textContent = g.device || 'RTX 3090';
                document.getElementById('gpu-util').textContent = g.utilization + '%';
                document.getElementById('gpu-util').className = 'metric-value ' + (g.utilization > 80 ? 'danger' : g.utilization > 50 ? 'warning' : 'success');
                document.getElementById('gpu-temp').textContent = g.temperature + '¬∞C';
                document.getElementById('gpu-power').textContent = g.power_draw.toFixed(1) + 'W / ' + g.power_limit.toFixed(0) + 'W';
                
                const vramPct = (g.used_mb / g.total_mb) * 100;
                document.getElementById('vram-bar').style.width = vramPct + '%';
                document.getElementById('vram-bar').className = 'memory-fill ' + (vramPct > 90 ? 'critical' : vramPct > 70 ? 'caution' : '');
                document.getElementById('vram-label').textContent = (g.used_mb/1024).toFixed(1) + ' / ' + (g.total_mb/1024).toFixed(0) + ' GB (' + vramPct.toFixed(1) + '%)';
            }
            
            // GPU History
            if (data.gpu_history && gpuChart) {
                const history = data.gpu_history;
                gpuChart.data.datasets[0].data = history.map(h => h.utilization);
                gpuChart.data.datasets[1].data = history.map(h => h.vram_pct);
                gpuChart.update('none');
            }
            
            // Network
            if (data.network && data.network.speed_mbps) {
                document.getElementById('net-up').textContent = data.network.speed_mbps.up.toFixed(2);
                document.getElementById('net-down').textContent = data.network.speed_mbps.down.toFixed(2);
            }
            
            // Ollama Models
            if (data.ollama_models) {
                const list = document.getElementById('ollama-list');
                if (data.ollama_models.length > 0) {
                    list.innerHTML = data.ollama_models.map(m => {
                        const vram = (m.vram / 1024).toFixed(1);
                        return `<div class="proc-item">
                            <span class="proc-name">üß† ${m.name}</span>
                            <span class="proc-pid">${vram}GB VRAM</span>
                        </div>`;
                    }).join('');
                } else {
                    list.innerHTML = '<div class="proc-item"><span class="metric-label">No models loaded</span></div>';
                }
            }
            
            // GPU Processes
            if (data.gpu_processes) {
                const list = document.getElementById('gpu-procs');
                if (data.gpu_processes.length > 0) {
                    list.innerHTML = data.gpu_processes.map(p => {
                        const vram = (p.vram_mb / 1024).toFixed(1);
                        const name = p.name.length > 20 ? p.name.substring(0, 20) + '...' : p.name;
                        return `<div class="proc-item">
                            <span class="proc-name">${name}</span>
                            <span class="proc-pid">${vram}GB</span>
                        </div>`;
                    }).join('');
                } else {
                    list.innerHTML = '<div class="proc-item"><span class="metric-label">No GPU processes</span></div>';
                }
            }
            
            // SWARM Topology
            if (data.swarm) {
                const swarm = data.swarm;
                document.getElementById('node-main').className = 'agent-node coordinator ' + (swarm.coordinator.active ? 'active' : '');
                document.getElementById('main-stats').textContent = swarm.coordinator.active ? 'Active' : 'Idle';
                
                document.getElementById('node-research').className = 'agent-node worker ' + (swarm.research.active ? 'active' : '');
                document.getElementById('research-stats').textContent = swarm.research.active ? 'API Mode' : 'Standby';
                
                document.getElementById('node-build').className = 'agent-node worker ' + (swarm.build.active ? 'active' : '');
                document.getElementById('build-stats').textContent = swarm.build.vram_mb > 0 ? (swarm.build.vram_mb/1024).toFixed(1) + 'GB VRAM' : 'Idle';
                
                document.getElementById('node-create').className = 'agent-node worker ' + (swarm.create.active ? 'active' : '');
                document.getElementById('create-stats').textContent = swarm.create.vram_mb > 0 ? (swarm.create.vram_mb/1024).toFixed(1) + 'GB VRAM' : 'Idle';
            }
            
            // Token Tracking
            if (data.token_tracker) {
                const tt = data.token_tracker;
                document.getElementById('tokens-kimi-in').textContent = tt.kimi.input.toLocaleString();
                document.getElementById('tokens-kimi-out').textContent = tt.kimi.output.toLocaleString();
                document.getElementById('tokens-kimi-total').textContent = (tt.kimi.input + tt.kimi.output).toLocaleString();
                
                document.getElementById('tokens-qwen-in').textContent = tt.qwen.input.toLocaleString();
                document.getElementById('tokens-qwen-out').textContent = tt.qwen.output.toLocaleString();
                document.getElementById('tokens-qwen-total').textContent = (tt.qwen.input + tt.qwen.output).toLocaleString();
                
                document.getElementById('tokens-gpt4o-in').textContent = tt.gpt4o.input.toLocaleString();
                document.getElementById('tokens-gpt4o-out').textContent = tt.gpt4o.output.toLocaleString();
                document.getElementById('tokens-gpt4o-total').textContent = (tt.gpt4o.input + tt.gpt4o.output).toLocaleString();
            }
            
            // Costs
            if (data.costs) {
                const costs = data.costs;
                document.getElementById('cost-kimi').textContent = '$' + costs.kimi.toFixed(4);
                document.getElementById('cost-qwen').textContent = '$' + costs.qwen.toFixed(2);
                document.getElementById('cost-gpt4o').textContent = '$' + costs.gpt4o.toFixed(4);
                const total = costs.kimi + costs.qwen + costs.gpt4o;
                document.getElementById('cost-total').textContent = '$' + total.toFixed(4);
                document.getElementById('session-cost').textContent = '$' + total.toFixed(2);
            }
            
            // Agent Activity Chart
            if (data.agent_activity && agentChart) {
                agentChart.data.datasets[0].data = data.agent_activity.qwen;
                agentChart.data.datasets[1].data = data.agent_activity.kimi;
                agentChart.update('none');
            }
            
            // Traces
            if (data.traces && data.traces.length > 0) {
                const list = document.getElementById('traces-list');
                list.innerHTML = data.traces.slice().reverse().map(t => {
                    const time = new Date(t.timestamp).toLocaleTimeString();
                    const icon = t.status === 'running' ? '‚è≥' : t.status === 'completed' ? '‚úÖ' : '‚ùå';
                    const statusClass = t.status;
                    return `<div class="trace-row">
                        <div class="trace-badge ${statusClass}">${icon}</div>
                        <div class="trace-task">${t.task}</div>
                        <div class="trace-tag ${statusClass}">${t.agent}</div>
                        <div class="trace-tag ${statusClass}">${t.status}</div>
                    </div>`;
                }).join('');
            }
        });
        
        socket.on('disconnect', () => {
            console.log('‚ùå Disconnected');
            connDot.classList.add('disconnected');
            connDot.style.background = '#ff4444';
            connText.textContent = 'Disconnected';
        });
    </script>
</body>
</html>
